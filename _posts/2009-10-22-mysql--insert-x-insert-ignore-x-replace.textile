---
layout: post
title: "MySQL: insert x insert ignore x replace"
---

h1. {{ page.title }}

p(meta). 22 Outubro 2009 - Niterói/RJ

Alguns detalhes que muitas vezes são ignorados podem facilitar muito a vida no MySQL.<br /><br /><br /><span class="Apple-style-span" style="font-size: 24px; font-weight: bold;">INSERT</span><br /><br />Talvez o <span class="caps">INSERT</span> seja o segundo comando <span class="caps">SQL</span> mais conhecido, perdendo apenas para o <span class="caps">SELECT</span>. Ele insere novos registros em uma tabela existente. Caso o <span class="caps">INSERT</span> esteja tentando inserir um registro que tenha a mesma chave primária (primary key) ou índice único (unique index) de outro já existente na tabela, ocorre um erro chamado <strong>erro de chave duplicada (duplicate-key error)</strong> e a execução é abortada. <br /><br />Se esse erro ocorrer no meio de um script <span class="caps">SQL</span>, a execução do script é abortada.<br /><br /><br /><span class="Apple-style-span" style="font-size: 24px; font-weight: bold;">REPLACE</span><br /><br />Funciona exatamente como o <span class="caps">INSERT</span>, porém se o registro que está sendo inserido tem a mesma chave primária (primary key) ou índice único (unique index) de outro já existente na tabela, esse registro já existente é apagado antes do novo ser inserido. E não ocorre erro.<br /><br /><h2><span class="caps">INSERT IGNORE</span></h2>A cláusula <span class="caps">IGNORE</span> altera um pouco o comportamento do <span class="caps">INSERT</span>:<br /><br />Se o registro que está sendo inserido tem a mesma chave primária (primary key) ou índice único (unique index) de outro já existente na tabela, o <span class="caps">INSERT IGNORE</span> é ignorado e não ocorre erro.<br /><br /><br />Tentativas de inserir registros com valores inválidos não causam erros. Os valores serão ajustados para valores mais aceitáveis e inseridos. Warnings são produzidos, mas a execução não é abortada.<br /><br /><h2>Resumindo</h2><span class="Apple-style-span" style="font-family: monospace; white-space: pre;"><span class="keyword keyword_other keyword_other_DML keyword_other_DML_sql">DELETE</span> <span class="keyword keyword_other keyword_other_DML keyword_other_DML_sql">FROM</span> <span class="string string_quoted string_quoted_other string_quoted_other_backtick string_quoted_other_backtick_sql"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_sql">`</span>table`</span>;</span><br /><pre class="textmate-source"><span class="source source_sql"><span class="keyword keyword_other keyword_other_DML keyword_other_DML_sql">INSERT INTO</span> <span class="string string_quoted string_quoted_other string_quoted_other_backtick string_quoted_other_backtick_sql"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_sql">`</span>table`</span> (<span class="string string_quoted string_quoted_other string_quoted_other_backtick string_quoted_other_backtick_sql"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_sql">`</span>id`</span>, <span class="string string_quoted string_quoted_other string_quoted_other_backtick string_quoted_other_backtick_sql"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_sql">`</span>name`</span>) <span class="keyword keyword_other keyword_other_DML keyword_other_DML_II keyword_other_DML_II_sql">VALUES</span> (<span class="constant constant_numeric constant_numeric_sql">1</span>, <span class="string string_quoted string_quoted_single string_quoted_single_sql"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_sql">"</span>Adriana"</span>);<br /><span class="keyword keyword_other keyword_other_DML keyword_other_DML_sql">INSERT INTO</span> <span class="string string_quoted string_quoted_other string_quoted_other_backtick string_quoted_other_backtick_sql"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_sql">`</span>table`</span> (<span class="string string_quoted string_quoted_other string_quoted_other_backtick string_quoted_other_backtick_sql"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_sql">`</span>id`</span>, <span class="string string_quoted string_quoted_other string_quoted_other_backtick string_quoted_other_backtick_sql"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_sql">`</span>name`</span>) <span class="keyword keyword_other keyword_other_DML keyword_other_DML_II keyword_other_DML_II_sql">VALUES</span> (<span class="constant constant_numeric constant_numeric_sql">1</span>, <span class="string string_quoted string_quoted_single string_quoted_single_sql"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_sql">"</span>Pedro"</span>);<br /><span class="keyword keyword_other keyword_other_DML keyword_other_DML_sql">INSERT INTO</span> <span class="string string_quoted string_quoted_other string_quoted_other_backtick string_quoted_other_backtick_sql"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_sql">`</span>table`</span> (<span class="string string_quoted string_quoted_other string_quoted_other_backtick string_quoted_other_backtick_sql"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_sql">`</span>id`</span>, <span class="string string_quoted string_quoted_other string_quoted_other_backtick string_quoted_other_backtick_sql"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_sql">`</span>name`</span>) <span class="keyword keyword_other keyword_other_DML keyword_other_DML_II keyword_other_DML_II_sql">VALUES</span> (<span class="constant constant_numeric constant_numeric_sql">2</span>, <span class="string string_quoted string_quoted_single string_quoted_single_sql"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_sql">"</span>Rafael"</span>);</span></pre><br />O primeiro <span class="caps">INSERT</span> será executado, o segundo dará erro e a execução será abortada (pois já foi inserido um registro com id = 1), o terceiro nem será executado.<br /><br />Resultado:<br /><pre class="textmate-source">+----+---------+<br />| id | name    |<br />+----+---------+<br />|  1 | Adriana |<br />+----+---------+<br /></pre><br /><br /><pre class="textmate-source"><span class="source source_sql"><span class="keyword keyword_other keyword_other_DML keyword_other_DML_sql">DELETE</span> <span class="keyword keyword_other keyword_other_DML keyword_other_DML_sql">FROM</span> <span class="string string_quoted string_quoted_other string_quoted_other_backtick string_quoted_other_backtick_sql"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_sql">`</span>table`</span>;<br />REPLACE INTO <span class="string string_quoted string_quoted_other string_quoted_other_backtick string_quoted_other_backtick_sql"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_sql">`</span>table`</span> (<span class="string string_quoted string_quoted_other string_quoted_other_backtick string_quoted_other_backtick_sql"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_sql">`</span>id`</span>, <span class="string string_quoted string_quoted_other string_quoted_other_backtick string_quoted_other_backtick_sql"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_sql">`</span>name`</span>) <span class="keyword keyword_other keyword_other_DML keyword_other_DML_II keyword_other_DML_II_sql">VALUES</span> (<span class="constant constant_numeric constant_numeric_sql">1</span>, <span class="string string_quoted string_quoted_single string_quoted_single_sql"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_sql">"</span>Adriana"</span>);<br />REPLACE INTO <span class="string string_quoted string_quoted_other string_quoted_other_backtick string_quoted_other_backtick_sql"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_sql">`</span>table`</span> (<span class="string string_quoted string_quoted_other string_quoted_other_backtick string_quoted_other_backtick_sql"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_sql">`</span>id`</span>, <span class="string string_quoted string_quoted_other string_quoted_other_backtick string_quoted_other_backtick_sql"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_sql">`</span>name`</span>) <span class="keyword keyword_other keyword_other_DML keyword_other_DML_II keyword_other_DML_II_sql">VALUES</span> (<span class="constant constant_numeric constant_numeric_sql">1</span>, <span class="string string_quoted string_quoted_single string_quoted_single_sql"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_sql">"</span>Pedro"</span>);<br />REPLACE INTO <span class="string string_quoted string_quoted_other string_quoted_other_backtick string_quoted_other_backtick_sql"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_sql">`</span>table`</span> (<span class="string string_quoted string_quoted_other string_quoted_other_backtick string_quoted_other_backtick_sql"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_sql">`</span>id`</span>, <span class="string string_quoted string_quoted_other string_quoted_other_backtick string_quoted_other_backtick_sql"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_sql">`</span>name`</span>) <span class="keyword keyword_other keyword_other_DML keyword_other_DML_II keyword_other_DML_II_sql">VALUES</span> (<span class="constant constant_numeric constant_numeric_sql">2</span>, <span class="string string_quoted string_quoted_single string_quoted_single_sql"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_sql">"</span>Rafael"</span>);</span></pre><br />O primeiro <span class="caps">REPLACE</span> será executado inserindo normalmente o registro como o <span class="caps">INSERT</span> faria. O segundo apagará o registro com id = 1 e adicionará outro registro com id = 1 sem erros. O terceiro <span class="caps">REPLACE</span> também será executado normalmente.<br /><br />Resultado:<br /><pre class="textmate-source">+----+--------+<br />| id | name   |<br />+----+--------+<br />|  1 | Pedro  |<br />|  2 | Rafael |<br />+----+--------+<br /></pre><br /><br /><pre class="textmate-source"><span class="source source_sql"><span class="keyword keyword_other keyword_other_DML keyword_other_DML_sql">DELETE</span> <span class="keyword keyword_other keyword_other_DML keyword_other_DML_sql">FROM</span> <span class="string string_quoted string_quoted_other string_quoted_other_backtick string_quoted_other_backtick_sql"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_sql">`</span>table`</span>;<br /><span class="keyword keyword_other keyword_other_DML keyword_other_DML_sql">INSERT IGNORE INTO</span> <span class="string string_quoted string_quoted_other string_quoted_other_backtick string_quoted_other_backtick_sql"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_sql">`</span>table`</span> (<span class="string string_quoted string_quoted_other string_quoted_other_backtick string_quoted_other_backtick_sql"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_sql">`</span>id`</span>, <span class="string string_quoted string_quoted_other string_quoted_other_backtick string_quoted_other_backtick_sql"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_sql">`</span>name`</span>) <span class="keyword keyword_other keyword_other_DML keyword_other_DML_II keyword_other_DML_II_sql">VALUES</span> (<span class="constant constant_numeric constant_numeric_sql">1</span>, <span class="string string_quoted string_quoted_single string_quoted_single_sql"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_sql">"</span>Adriana"</span>);<br /><span class="keyword keyword_other keyword_other_DML keyword_other_DML_sql">INSERT IGNORE INTO</span> <span class="string string_quoted string_quoted_other string_quoted_other_backtick string_quoted_other_backtick_sql"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_sql">`</span>table`</span> (<span class="string string_quoted string_quoted_other string_quoted_other_backtick string_quoted_other_backtick_sql"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_sql">`</span>id`</span>, <span class="string string_quoted string_quoted_other string_quoted_other_backtick string_quoted_other_backtick_sql"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_sql">`</span>name`</span>) <span class="keyword keyword_other keyword_other_DML keyword_other_DML_II keyword_other_DML_II_sql">VALUES</span> (<span class="constant constant_numeric constant_numeric_sql">1</span>, <span class="string string_quoted string_quoted_single string_quoted_single_sql"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_sql">"</span>Pedro"</span>);<br /><span class="keyword keyword_other keyword_other_DML keyword_other_DML_sql">INSERT IGNORE INTO</span> <span class="string string_quoted string_quoted_other string_quoted_other_backtick string_quoted_other_backtick_sql"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_sql">`</span>table`</span> (<span class="string string_quoted string_quoted_other string_quoted_other_backtick string_quoted_other_backtick_sql"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_sql">`</span>id`</span>, <span class="string string_quoted string_quoted_other string_quoted_other_backtick string_quoted_other_backtick_sql"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_sql">`</span>name`</span>) <span class="keyword keyword_other keyword_other_DML keyword_other_DML_II keyword_other_DML_II_sql">VALUES</span> (<span class="constant constant_numeric constant_numeric_sql">2</span>, <span class="string string_quoted string_quoted_single string_quoted_single_sql"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_sql">"</span>Rafael"</span>);</span></pre><br />O primeiro <span class="caps">INSERT IGNORE</span> vai inserir o registro exatamente como o <span class="caps">INSERT</span> sozinho faria. O segundo vai tentar inserir outro registro, mas como a chave está duplicada, será ignorado sem erros. O terceiro <span class="caps">INSERT IGNORE</span> também será executado normalmente.<br /><br />Resultado:<br /><br /><pre class="textmate-source">+----+---------+<br />| id | name    |<br />+----+---------+<br />|  1 | Adriana |<br />|  2 | Rafael  |<br />+----+---------+<br /></pre><div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/1372066769163881306-1383470475462483525?l=rafael.xlii.com.br' alt='' /></div>