---
layout: post
title: Configuração de upload em PHP
---

h1. {{ page.title }}

p(meta). 25 Junho 2009 - Niterói/RJ

O programador não pode esquecer de algumas coisas quando vai trabalhar com upload de arquivos em <span class="caps">PHP</span>. Principalmente as diretivas do php.ini.<br /><br /><br /><h2>As que ninguém esquece:</h2><br /><a href="http://us3.php.net/manual/pt_BR/ini.core.php#ini.upload-max-filesize">upload_max_filesize</a><br /><br /><br /><br />define qual o tamanho máximo permitido por arquivo. o valor padrão é 2 megas. se o arquivo exceder esse limite, $_FILES["file"]["error"] chega com valor 1.<br /><br /><br /><a href="http://us3.php.net/manual/pt_BR/ini.core.php#ini.file-uploads">file_uploads</a><br /><br /><br />define se é permitido o upload de arquivos. o valor padrão é On.<br /><br /><br /><a href="http://us3.php.net/manual/pt_BR/ini.core.php#ini.upload-tmp-dir">upload_tmp_dir</a><br /><br /><br />define o diretório temporário usado para guardar os arquivos de upload. o usuário que está executando o web script (em geral, o mesmo usuário do Web Server) deve ter permissão de escrita nesse diretório. se não for especificado, será usado o diretório temporário padrão do sistema.<br /><br /><br /><h2>O que <del>quase</del> ninguém lembra:</h2><br /><a href="http://us3.php.net/manual/pt_BR/ini.core.php#ini.post-max-size">post_max_size</a><br /><br /><br />muito importante! define o tamanho máximo dos dados enviados via <span class="caps">POST</span>. isso afeta diretamente o upload de arquivos. esse valor deve <strong>sempre</strong> ser maior que upload_max_filesize! o valor padrão é 8 megas.<br /><br /><br />se o tamanho de dados exceder o valor de post_max_size, $_POST e $_FILES chegarão vazios. e por isso <del></del><br />eu<br />muita gente<br />fica horas pra descobrir porque consegue fazer upload de arquivos pequenos mas não consegue com arquivos grandes. não dá erro, o arquivo simplesmente não chega. diferente do que acontece quando o arquivo excede apenas o upload_max_filesize.<br /><br /><br /><a href="http://us3.php.net/manual/pt_BR/ini.core.php#ini.memory-limit">memory_limit</a><br /><br /><br />define a quantidade máxima de memória que o script pode alocar. isso também afeta upload de arquivos. o manual do <span class="caps">PHP</span> fala que memory_limit deve ser maior que post_max_size, mas eu mesmo já consegui fazer upload de arquivos maiores que o valor configurado nessa diretiva. vai entender! valor padrão: 128 megas.<br /><br /><br />observação importante: todas essas diretivas que definem tamanho recebem o valor em bytes. porém, como o <span class="caps">PHP</span> tem a péssima mania de querer fazer tudo ao mesmo tempo, pode ser usado uma notação mais amigável: K (pra Kilobyte), M (pra Megabyte) and G (pra Gigabyte). por exemplo: 1K ao invés de 1024. isso só vale dentro do php.ini.<br /><br /><br />exemplo prático do uso das diretivas acima. no php.ini:<br /><br /><br /><br /><pre class="textmate-source"><span class="source source_git-config"><span class="comment comment_line comment_line_semi-colon comment_line_semi-colon_git-config"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_git-config">;</span> Maximum allowed size for uploaded files.<br /></span>upload_max_filesize = 100M<br /><br /><span class="comment comment_line comment_line_semi-colon comment_line_semi-colon_git-config"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_git-config">;</span> Whether to allow HTTP file uploads.<br /></span>file_uploads = On<br /><br /><span class="comment comment_line comment_line_semi-colon comment_line_semi-colon_git-config"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_git-config">;</span> Temporary directory for HTTP uploaded files (will use system default if not specified).<br /></span><span class="comment comment_line comment_line_semi-colon comment_line_semi-colon_git-config"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_git-config">;</span> upload_tmp_dir =<br /></span><br /><span class="comment comment_line comment_line_semi-colon comment_line_semi-colon_git-config"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_git-config">;</span> Maximum size of POST data that PHP will accept.<br /></span>post_max_size = 128M<br /><br /><span class="comment comment_line comment_line_semi-colon comment_line_semi-colon_git-config"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_git-config">;</span> Maximum amount of memory a script may consume (8MB)<br /></span>memory_limit = 256M</span></pre><div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/1372066769163881306-5701874652396569899?l=rafael.xlii.com.br' alt='' /></div>